<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suno Prompt Baker</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="notification-container"></div>

  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="app-logo">
        <h1>Suno Prompt Baker</h1>
        <span class="subtitle" data-i18n="app.subtitle"></span>
      </div>
      <div class="header-actions">
        <button class="btn-lang" id="lang-toggle" title="Switch Language">中文</button>
        <button class="btn-icon" id="btn-history" data-i18n-title="nav.history">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </button>
        <button class="btn-icon" id="btn-settings" data-i18n-title="nav.settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="style">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        <span data-i18n="nav.styleBaker">Style Baker</span>
      </button>
      <button class="nav-tab" data-tab="lyrics">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        <span data-i18n="nav.lyricsBaker">Lyrics Baker</span>
      </button>
    </nav>

    <!-- ===== Style Baker Panel ===== -->
    <div class="tab-panel" id="panel-style">
      <!-- Genre -->
      <div class="section">
        <div class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
          <span data-i18n="style.genre">Genre</span>
        </div>
        <div class="chip-group" id="genre-chips"></div>

        <div class="form-group mt-16">
          <label class="form-label" data-i18n="style.subGenre">Sub-genre / Fusion</label>
          <input type="text" id="sub-genre" data-i18n-placeholder="style.subGenrePlaceholder">
        </div>
      </div>

      <!-- Mood -->
      <div class="section">
        <div class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
          <span data-i18n="style.mood">Mood / Emotion</span>
        </div>
        <div class="chip-group" id="mood-chips"></div>
      </div>

      <!-- Tempo & Vocal & Era -->
      <div class="section">
        <div class="flex-row">
          <div class="form-group">
            <label class="form-label" data-i18n="style.tempo">Tempo</label>
            <select id="tempo-select">
              <option value="Slow" data-i18n="style.tempoSlow">Slow (60-80 BPM)</option>
              <option value="Medium-Slow" data-i18n="style.tempoMediumSlow">Medium-Slow (80-100 BPM)</option>
              <option value="Medium" selected data-i18n="style.tempoMedium">Medium (100-120 BPM)</option>
              <option value="Medium-Fast" data-i18n="style.tempoMediumFast">Medium-Fast (120-140 BPM)</option>
              <option value="Fast" data-i18n="style.tempoFast">Fast (140-180 BPM)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <span data-i18n="style.bpm">BPM</span>
              <small style="color: var(--text-muted); font-weight: normal;"> (optional override)</small>
            </label>
            <input type="number" id="bpm-input" min="40" max="220" placeholder="Auto" style="width: 100px;">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="style.era">Era / Aesthetic</label>
            <input type="text" id="era-input" data-i18n-placeholder="style.eraPlaceholder">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span data-i18n="style.voiceType">Voice Type</span>
            <small style="display: block; color: var(--text-muted); font-size: 0.8rem; font-weight: normal; margin-top: 2px;" data-i18n="style.voiceTypeHint">Gender and delivery style</small>
          </label>
          <div class="chip-group" id="vocal-chips"></div>
        </div>

        <!-- Voice Character (NEW - formerly Vocal Texture) -->
        <div class="form-group">
          <label class="form-label">
            <span data-i18n="style.voiceCharacter">Voice Character</span>
            <small style="display: block; color: var(--text-muted); font-size: 0.8rem; font-weight: normal; margin-top: 2px;" data-i18n="style.voiceCharacterHint">Tone quality and texture (optional)</small>
          </label>
          <div class="chip-group" id="vocal-texture-chips"></div>
        </div>
      </div>

      <!-- Instruments -->
      <div class="section">
        <div class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
          <span data-i18n="style.instruments">Instruments</span>
        </div>

        <div class="instrument-search-row">
          <input type="text" id="instrument-search" data-i18n-placeholder="style.instrumentSearch">
          <button class="btn btn-ghost" id="btn-suggest-instruments">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a5 5 0 0 1 5 5c0 2.76-2.24 5-5 5s-5-2.24-5-5a5 5 0 0 1 5-5z"/><path d="M12 14l-3 8h6l-3-8z"/></svg>
            <span data-i18n="style.suggestInstruments">AI Suggest</span>
          </button>
        </div>

        <div class="instrument-panel">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <h4 data-i18n="style.instrumentsHigh" style="margin: 0;">High Register</h4>
            <button type="button" class="btn btn-sm btn-ghost" id="btn-add-inst-high" title="Add custom instrument">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
          </div>
          <div class="chip-group" id="inst-high-chips"></div>
        </div>

        <div class="instrument-panel">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <h4 data-i18n="style.instrumentsMid" style="margin: 0;">Mid Register</h4>
            <button type="button" class="btn btn-sm btn-ghost" id="btn-add-inst-mid" title="Add custom instrument">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
          </div>
          <div class="chip-group" id="inst-mid-chips"></div>
        </div>

        <div class="instrument-panel">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <h4 data-i18n="style.instrumentsLow" style="margin: 0;">Low Register</h4>
            <button type="button" class="btn btn-sm btn-ghost" id="btn-add-inst-low" title="Add custom instrument">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
          </div>
          <div class="chip-group" id="inst-low-chips"></div>
        </div>
      </div>

      <!-- Production / Mix Layer (NEW) -->
      <div class="section">
        <div class="section-title">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="7" y1="7" x2="7" y2="13"/><line x1="12" y1="5" x2="12" y2="13"/><line x1="17" y1="9" x2="17" y2="13"/></svg>
          <span data-i18n="style.production">Production / Mix Quality</span>
        </div>
        <div class="chip-group" id="production-chips"></div>
      </div>

      <!-- Exclusions (NEW) -->
      <div class="section">
        <div class="form-group">
          <label class="form-label">
            <span data-i18n="style.exclusions">Exclusions (Negative Prompt)</span>
            <small style="color: var(--text-muted); font-weight: normal;"> - What to avoid</small>
          </label>
          <input type="text" id="exclusions-input" placeholder="e.g., no vocals, no piano, no reverb" data-i18n-placeholder="style.exclusionsPlaceholder">
          <small id="exclusions-hint" style="display: block; margin-top: 4px; color: var(--text-muted); font-size: 0.85rem;"></small>
        </div>
      </div>

      <!-- Freeform -->
      <div class="section">
        <div class="form-group">
          <label class="form-label" data-i18n="style.freeform">Additional Description</label>
          <textarea id="freeform-input" rows="3" data-i18n-placeholder="style.freeformPlaceholder"></textarea>
          <small id="freeform-hint" style="display: block; margin-top: 4px; color: var(--text-muted); font-size: 0.85rem;"></small>
        </div>
      </div>

      <!-- Prompt Mode Toggle (NEW) -->
      <div class="section" style="background: var(--bg-elevated); padding: 12px; border-radius: 8px;">
        <div class="form-group" style="margin: 0;">
          <label class="form-label" style="margin-bottom: 8px;">
            <span data-i18n="style.promptMode">Prompt Mode</span>
          </label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="style-mode" id="mode-keyword" value="keyword" checked>
              <label for="mode-keyword">
                <span data-i18n="style.modeKeyword">Keyword (Classic)</span>
                <small style="display: block; color: var(--text-muted); font-size: 0.8rem;">Comma-separated tags</small>
              </label>
            </div>
            <div class="radio-option">
              <input type="radio" name="style-mode" id="mode-blueprint" value="blueprint">
              <label for="mode-blueprint">
                <span data-i18n="style.modeBlueprint">Blueprint (Narrative)</span>
                <small style="display: block; color: var(--text-muted); font-size: 0.8rem;">Temporal prose description</small>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Bake Button -->
      <!-- Action Row -->
      <div style="display: flex; gap: 12px; align-items: center;">
        <button class="btn btn-ghost" id="btn-load-template" style="flex: 0 0 auto;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
          <span data-i18n="style.loadTemplate">Load Template</span>
        </button>
        <button class="btn btn-primary" id="btn-bake-style" style="flex: 1; padding: 14px;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 12l3 3 5-5"/></svg>
          <span data-i18n="style.bake">Bake Style</span>
        </button>
      </div>

      <!-- Result -->
      <div class="section result-section hidden" id="style-result-section">
        <div class="section-title" data-i18n="style.result">Generated Style Prompt</div>
        <textarea class="result-area" id="style-result" rows="4"></textarea>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
          <span id="char-counter" style="font-size: 0.85rem; color: var(--text-muted);"></span>
          <div style="display: flex; gap: 8px;">
            <span id="quality-indicator" style="font-size: 0.85rem; padding: 2px 8px; border-radius: 4px;"></span>
          </div>
        </div>
        <div class="result-actions">
          <button class="btn btn-ghost" id="btn-copy-style">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            <span data-i18n="style.copy">Copy</span>
          </button>
          <button class="btn btn-ghost" id="btn-regen-style">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            <span data-i18n="style.regenerate">Regenerate</span>
          </button>
          <button class="btn btn-ghost" id="btn-compare-style">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="18" rx="1"/><rect x="14" y="3" width="7" height="18" rx="1"/></svg>
            <span data-i18n="style.compare">Compare</span>
          </button>
        </div>

        <!-- Suno Parameter Guidance (NEW) -->
        <div id="suno-guidance" class="hidden" style="margin-top: 16px; padding: 16px; background: var(--bg-elevated); border-radius: 8px; border-left: 3px solid var(--accent);">
          <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: var(--accent);">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            <span data-i18n="style.sunoSettings">Recommended Suno Settings</span>
          </h4>
          <div id="suno-guidance-content"></div>
        </div>
      </div>
    </div>

    <!-- ===== Lyrics Baker Panel ===== -->
    <div class="tab-panel hidden" id="panel-lyrics">
      <!-- Mode Toggle -->
      <div class="section">
        <div class="form-group">
          <label class="form-label" data-i18n="lyrics.mode">Generation Mode</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="lyrics-mode" id="mode-full" value="full" checked>
              <label for="mode-full" data-i18n="lyrics.modeFull">Full Generation</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="lyrics-mode" id="mode-expand" value="expand">
              <label for="mode-expand" data-i18n="lyrics.modeExpand">Expand / Complete</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="lyrics-mode" id="mode-chain" value="chain">
              <label for="mode-chain">
                <span data-i18n="lyrics.modeChain">Section Chain</span>
                <small style="display: block; color: var(--text-muted); font-size: 0.8rem;">Generate section-by-section</small>
              </label>
            </div>
            <div class="radio-option">
              <input type="radio" name="lyrics-mode" id="mode-scaffold" value="scaffold">
              <label for="mode-scaffold">
                <span data-i18n="lyrics.modeScaffold">Scaffolding Mode</span>
                <small style="display: block; color: var(--text-muted); font-size: 0.8rem;">3-phase: Phonetic → Lock → Semantic</small>
              </label>
            </div>
          </div>
        </div>

        <!-- Style Context -->
        <div class="form-group">
          <label class="form-label" data-i18n="lyrics.styleContext">Style Context (from Style Baker)</label>
          <textarea id="lyrics-style-context" rows="2" data-i18n-placeholder="lyrics.styleContextPlaceholder"></textarea>
        </div>

        <!-- Instrumental Toggle -->
        <div class="form-group">
          <label class="checkbox-label" for="lyrics-instrumental">
            <input type="checkbox" id="lyrics-instrumental">
            <span data-i18n="lyrics.instrumental">Instrumental (No Lyrics)</span>
          </label>
        </div>

        <!-- Language & Duration -->
        <div class="flex-row">
          <div class="form-group" id="lyrics-lang-group">
            <label class="form-label" data-i18n="lyrics.lyricsLanguage">Lyrics Language</label>
            <select id="lyrics-language">
              <option value="en" data-i18n="lyrics.lyricsLangEn">English</option>
              <option value="zh" data-i18n="lyrics.lyricsLangZh">Chinese</option>
              <option value="es" data-i18n="lyrics.lyricsLangEs">Spanish</option>
              <option value="fr" data-i18n="lyrics.lyricsLangFr">French</option>
              <option value="ja" data-i18n="lyrics.lyricsLangJa">Japanese</option>
              <option value="ko" data-i18n="lyrics.lyricsLangKo">Korean</option>
              <option value="pt" data-i18n="lyrics.lyricsLangPt">Portuguese</option>
              <option value="de" data-i18n="lyrics.lyricsLangDe">German</option>
              <option value="hi" data-i18n="lyrics.lyricsLangHi">Hindi</option>
              <option value="ar" data-i18n="lyrics.lyricsLangAr">Arabic</option>
              <option value="multi" data-i18n="lyrics.lyricsLangMulti">Multilingual</option>
              <option value="other" data-i18n="lyrics.lyricsLangOther">Other</option>
            </select>
            <small id="lang-suggestion" style="display: block; margin-top: 4px; color: var(--accent); font-size: 0.85rem;"></small>
            <input type="text" id="lyrics-lang-custom" class="hidden mt-8" data-i18n-placeholder="lyrics.lyricsLangCustomPlaceholder">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="lyrics.duration">Song Duration</label>
            <select id="lyrics-duration">
              <option value="auto" data-i18n="lyrics.durationNone">Auto</option>
              <option value="short" data-i18n="lyrics.durationShort">Short (~2 min)</option>
              <option value="medium" data-i18n="lyrics.durationMedium">Medium (~3 min)</option>
              <option value="long" data-i18n="lyrics.durationLong">Long (~4+ min)</option>
            </select>
          </div>
        </div>

        <!-- Energy Arc Mapping (NEW) -->
        <div class="form-group" id="energy-arc-section">
          <label class="form-label">
            <span data-i18n="lyrics.energyArc">Energy Arc / Dynamic Progression</span>
            <small style="color: var(--text-muted); font-weight: normal;"> (optional)</small>
          </label>
          <div id="energy-arc-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;"></div>
        </div>

        <!-- Full Generation Input -->
        <div class="form-group" id="lyrics-full-input">
          <label class="form-label" data-i18n="lyrics.conceptLabel">Theme / Concept / Story</label>
          <textarea id="lyrics-concept" rows="4" data-i18n-placeholder="lyrics.conceptPlaceholder"></textarea>
        </div>

        <!-- Expand Input -->
        <div class="form-group hidden" id="lyrics-expand-input">
          <label class="form-label" data-i18n="lyrics.expandLabel">Partial Lyrics / Draft</label>
          <textarea id="lyrics-partial" rows="8" data-i18n-placeholder="lyrics.expandPlaceholder"></textarea>
        </div>
      </div>

      <!-- Bake Button -->
      <button class="btn btn-primary" id="btn-bake-lyrics" style="width:100%; padding: 14px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        <span data-i18n="lyrics.bake">Bake Lyrics</span>
      </button>

      <!-- Title -->
      <div class="section result-section hidden" id="lyrics-title-section">
        <div class="section-title" data-i18n="lyrics.titleLabel">Song Title</div>
        <div class="title-display-row">
          <input type="text" class="result-area" id="lyrics-title" readonly>
          <button class="btn btn-ghost btn-sm" id="btn-copy-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            <span data-i18n="lyrics.copy">Copy</span>
          </button>
        </div>
      </div>

      <!-- Result -->
      <div class="section result-section hidden" id="lyrics-result-section">
        <div class="section-title" data-i18n="lyrics.result">Generated Lyrics</div>

        <!-- Meta-Tag Insertion Toolbar (NEW) -->
        <div id="metatag-toolbar" style="margin-bottom: 12px; padding: 12px; background: var(--bg-elevated); border-radius: 6px;">
          <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 0.9rem; color: var(--text-muted); font-weight: 500;">Insert Tag:</span>
            <select id="metatag-category" style="flex: 0 0 auto; min-width: 140px;">
              <option value="">Select category...</option>
              <option value="structure">Structure</option>
              <option value="energy">Energy / Dynamics</option>
              <option value="tension">Tension / Transition</option>
              <option value="vocal">Vocal Texture</option>
              <option value="harmonic">Harmonic</option>
              <option value="dsp">DSP / Processing</option>
            </select>
            <select id="metatag-tag" style="flex: 1; min-width: 160px;" disabled>
              <option value="">Select tag...</option>
            </select>
            <button class="btn btn-sm btn-ghost" id="btn-insert-tag" disabled>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Insert
            </button>
          </div>
        </div>

        <textarea class="result-area" id="lyrics-result" rows="20"></textarea>
        <div class="result-actions">
          <button class="btn btn-ghost" id="btn-copy-lyrics">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            <span data-i18n="lyrics.copy">Copy</span>
          </button>
          <button class="btn btn-ghost" id="btn-regen-lyrics">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            <span data-i18n="lyrics.regenerate">Regenerate</span>
          </button>
          <button class="btn btn-ghost" id="btn-compare-lyrics">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="18" rx="1"/><rect x="14" y="3" width="7" height="18" rx="1"/></svg>
            <span data-i18n="lyrics.compare">Compare</span>
          </button>
        </div>
      </div>
    </div>

    <footer style="text-align: center; padding: 32px 0 24px; color: var(--text-muted); font-size: 0.78rem;">
      Suno Prompt Baker &mdash; All AI outputs in English. API keys stored locally only.
    </footer>
  </div>

  <!-- ===== Settings Modal ===== -->
  <div class="modal-overlay" id="settings-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 data-i18n="settings.title">API Configuration</h2>
        <button class="modal-close" id="settings-close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- OpenAI Compatible -->
        <div class="provider-section">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
            <span data-i18n="settings.providerOpenAI">OpenAI-Compatible</span>
          </h3>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.baseUrl">API Base URL</label>
            <input type="url" id="openai-base-url" value="https://api.openai.com/v1">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.apiKey">API Key</label>
            <input type="password" id="openai-api-key" placeholder="sk-...">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.model">Model Name</label>
            <input type="text" id="openai-model" value="gpt-4o" placeholder="gpt-4o">
          </div>
          <div class="test-row">
            <button class="btn btn-sm btn-ghost" id="btn-test-openai" data-i18n="settings.testConnection">Test Connection</button>
            <span class="test-status" id="test-status-openai"></span>
          </div>
        </div>

        <!-- Gemini -->
        <div class="provider-section">
          <h3>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            <span data-i18n="settings.providerGemini">Google Gemini</span>
          </h3>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.baseUrl">API Base URL</label>
            <input type="url" id="gemini-base-url" value="https://generativelanguage.googleapis.com">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.apiKey">API Key</label>
            <input type="password" id="gemini-api-key" placeholder="AI...">
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="settings.model">Model Name</label>
            <input type="text" id="gemini-model" value="gemini-2.0-flash" placeholder="gemini-2.0-flash">
          </div>
          <div class="test-row">
            <button class="btn btn-sm btn-ghost" id="btn-test-gemini" data-i18n="settings.testConnection">Test Connection</button>
            <span class="test-status" id="test-status-gemini"></span>
          </div>
        </div>

        <!-- Active Provider -->
        <div class="active-provider-section">
          <label class="form-label" data-i18n="settings.activeProvider">Active Provider</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="active-provider" id="active-openai" value="openai">
              <label for="active-openai" data-i18n="settings.providerOpenAI">OpenAI-Compatible</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="active-provider" id="active-gemini" value="gemini">
              <label for="active-gemini" data-i18n="settings.providerGemini">Google Gemini</label>
            </div>
          </div>
          <button class="btn btn-primary mt-16" id="btn-save-settings" style="width:100%;" data-i18n="settings.save">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== History Modal ===== -->
  <div class="modal-overlay" id="history-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 data-i18n="history.title">Generation History</h2>
        <button class="modal-close" id="history-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="history-list"></div>
        <div class="history-footer">
          <button class="btn btn-sm btn-ghost btn-danger" id="btn-clear-history" data-i18n="history.clearAll">Clear All</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Instrument Suggestion Modal ===== -->
  <div class="modal-overlay" id="suggestion-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 data-i18n="style.suggestInstruments">AI Suggest Instruments</h2>
        <button class="modal-close" id="suggestion-close">&times;</button>
      </div>
      <div class="modal-body" id="suggestion-content"></div>
    </div>
  </div>

  <!-- ===== Template Library Modal (NEW) ===== -->
  <div class="modal-overlay" id="template-modal">
    <div class="modal modal-wide">
      <div class="modal-header">
        <h2 data-i18n="templates.title">Prompt Templates</h2>
        <button class="modal-close" id="template-close">&times;</button>
      </div>
      <div class="modal-body" id="template-list"></div>
    </div>
  </div>

  <!-- ===== Comparison Modal (NEW) ===== -->
  <div class="modal-overlay" id="compare-modal">
    <div class="modal modal-wide">
      <div class="modal-header">
        <h2 data-i18n="compare.title">Version Comparison</h2>
        <button class="modal-close" id="compare-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="compare-controls" style="margin-bottom: 16px; display: flex; gap: 12px;">
          <select id="compare-version-a" style="flex: 1;"></select>
          <select id="compare-version-b" style="flex: 1;"></select>
        </div>
        <div id="compare-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;"></div>
      </div>
    </div>
  </div>

  <!-- ===== Suno-Ready Preview Modal (NEW) ===== -->
  <div class="modal-overlay" id="suno-preview-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 data-i18n="sunoPreview.title">Suno-Ready Output</h2>
        <button class="modal-close" id="suno-preview-close">&times;</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <h3 style="margin: 0; font-size: 1rem; color: var(--accent);">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
              Paste into Suno's "Style of Music" field
            </h3>
            <button class="btn btn-sm btn-ghost" id="btn-copy-suno-style">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <textarea id="suno-style-field" readonly rows="3" style="width: 100%; padding: 12px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; font-family: monospace; font-size: 0.9rem;"></textarea>
        </div>
        <div>
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <h3 style="margin: 0; font-size: 1rem; color: var(--accent);">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
              Paste into Suno's "Lyrics" field
            </h3>
            <button class="btn btn-sm btn-ghost" id="btn-copy-suno-lyrics">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <textarea id="suno-lyrics-field" readonly rows="15" style="width: 100%; padding: 12px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; font-family: monospace; font-size: 0.9rem;"></textarea>
        </div>
        <div id="suno-title-field-container" class="hidden" style="margin-top: 16px; padding: 12px; background: var(--bg-subtle); border-radius: 6px;">
          <strong style="color: var(--text-muted); font-size: 0.9rem;">Song Title (for reference):</strong>
          <div id="suno-title-display" style="margin-top: 4px; font-family: monospace; color: var(--text);"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/meta-tags.js"></script>
  <script src="js/templates.js"></script>
  <script src="js/validation.js"></script>
  <script src="js/versions.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/instruments.js"></script>
  <script src="js/api.js"></script>
  <script src="js/history.js"></script>
  <script src="js/style-baker.js"></script>
  <script src="js/lyrics-baker.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
